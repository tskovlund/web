{% extends "base.html" %}

{% load humanize %}

{% block pagetitle %}Player {{ object.username }}{% endblock %}

{% block content %}

<h2>
	{% if object.is_staff %}
	<i class="fas fa-crown" style="color: #dc3545;"></i>
	{% endif %}

	{{ object.username }} 

	{% if object == user %}
		<a class="btn btn-primary float-right text-light col-md-auto" href="/settings/">Profile settings</a>
		<br><br class="d-lg-none">
	{% endif %}
	{% if user.is_staff and object != user %}
		<a class="btn btn-primary float-right text-light col-md-auto" href="/admin/games/user/{{ object.id }}/change/">Edit</a>
		<br><br class="d-lg-none">
	{% endif %}
</h2>

<hr>

<div class="row">
	<div class="col-md-auto text-center">
		<img src="{{ object.image_url }}" alt="Profile picture" class="rounded">
	</div>
	<div class="col-md-10 d-none d-lg-block">
		<div style="display: flex; align-items: center; height: 100%;">
			<canvas id="heatmap" style="width: 100%; height: 175px;"></canvas>
		</div>
	</div>
</div>

<br>

<h4>
	<i class="fas fa-trophy"></i> Rank

	<div style="float: right; margin-top: -7px;">
		{% include "season_chooser.html" %}
	</div>
</h4>

<hr>

<div class="container">
	<div class="row">
		{% for ranking in rankings %}
		<div class="card col-md-2 ml-auto mr-auto">
			<div class="card-body text-center">
				<p class="card-title mb-2">{{ ranking.name }}</p>
				<h4 class="card-text">{% spaceless %}
					{% if ranking.rank %}
						<a href="{{ ranking.url }}">#{{ ranking.rank }}</a>
					{% else %}
						-
					{% endif %}
					{% endspaceless %}</h4>
			</div>
		</div>
		{% endfor %}
	</div>
</div>

<br>

<h4><i class="fas fa-chart-pie"></i> Stats</h4>

<hr>

<div class="row">
	<div class="col-md-6">
		<table class="table table-bordered table-striped table-sm">
			<tbody>
				<tr>
					<th>Games played</th>
					<td>{{ stats.total_games|intcomma }}</td>
				</tr>
				<tr>
					<th>Total time played</th>
					<td>{{ stats.total_time_played }}
						<br>
						(~ {{ stats.approx_ects|floatformat:1 }} ECTS)</td>
				</tr>
				<tr>
					<th>Estimated money spent</th>
					<td>{{ stats.approx_money_spent|intcomma }}</td>
				</tr>
			</tbody>
		</table>
	</div>
	<div class="col-md-6">
		<table class="table table-bordered table-striped table-sm">
			<tbody>
				<tr>
					<th>Total sips</th>
					<td>{{ stats.total_sips|intcomma }} ({{ stats.total_beers|floatformat:0|intcomma }} beers)</td>
				</tr>
				<tr>
					<th>Best game</th>
					<td>{% include "utils/link.html" with text=stats.best_game_sips prefix="/games" id=stats.best_game.id %}
					</td>
				</tr>
				<tr>
					<th>Worst game</th>
					<td>{% include "utils/link.html" with text=stats.worst_game_sips prefix="/games" id=stats.worst_game.id %}
					</td>
				</tr>
				<tr>
					<th>Average game</th>
					<td>{% firstof stats.average_game_sips "-" %}</a></td>
				</tr>
				<tr>
					<th>Total chugs</th>
					<td>{{ stats.total_chugs|intcomma }}</td>
				</tr>
				<tr>
					<th>Fastest chug time</th>
					<td>{% include "utils/link.html" with text=stats.fastest_chug.duration prefix="/games" id=stats.fastest_chug.card.game.id %}
					</td>
				</tr>
				<tr>
					<th>Average chug time</th>
					<td>{% firstof stats.average_chug_time "-" %}</td>
				</tr>
			</tbody>
		</table>
	</div>
</div>

{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.heatmap.js@0.0.1-alpha/dst/Chart.HeatMap.S.min.js" integrity="sha256-lZtbPyu8/+LnH18+MWYsQjGEWfHgs8ISXNHlyr46NZw=" crossorigin="anonymous"></script>

{{ heatmap_data|json_script:"heatmap_data" }}

<script>
	var data = JSON.parse(document.getElementById("heatmap_data").textContent);

	var options = {
		rounded: false,
		paddingScale: 0.25,
		colorInterpolation: "palette",
		colors: ["#ebedf0", "#c6e48b", "#7bc96f", "#239a3b", "#196127"],
		showLabels: false,
		tooltipTemplate: "<%= yLabel %>: <%= value %>",
	};

	var ctx = document.getElementById("heatmap").getContext("2d");
	var chart = new Chart(ctx).HeatMap(data, options);
</script>
{% endblock %}
